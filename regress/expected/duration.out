CREATE EXTENSION pg_duration;
-- Valid duration input
SELECT duration '42 hour';
  duration  
------------
 @ 42 hours
(1 row)

SELECT duration '43 hours';
  duration  
------------
 @ 43 hours
(1 row)

SELECT duration '44 h';
  duration  
------------
 @ 44 hours
(1 row)

SELECT duration '45 minute';
 duration  
-----------
 @ 45 mins
(1 row)

SELECT duration '46 minutes';
 duration  
-----------
 @ 46 mins
(1 row)

SELECT duration '47 m';
 duration  
-----------
 @ 47 mins
(1 row)

SELECT duration '48 second';
 duration  
-----------
 @ 48 secs
(1 row)

SELECT duration '49 seconds';
 duration  
-----------
 @ 49 secs
(1 row)

SELECT duration '50 s';
 duration  
-----------
 @ 50 secs
(1 row)

SELECT duration '51 millisecond';
   duration   
--------------
 @ 0.051 secs
(1 row)

SELECT duration '52 milliseconds';
   duration   
--------------
 @ 0.052 secs
(1 row)

SELECT duration '53 ms';
   duration   
--------------
 @ 0.053 secs
(1 row)

SELECT duration '54 microsecond';
    duration     
-----------------
 @ 0.000054 secs
(1 row)

SELECT duration '55 microseconds';
    duration     
-----------------
 @ 0.000055 secs
(1 row)

SELECT duration '56 us';
    duration     
-----------------
 @ 0.000056 secs
(1 row)

SELECT duration '-42 hour';
    duration    
----------------
 @ 42 hours ago
(1 row)

SELECT duration '-43 hours';
    duration    
----------------
 @ 43 hours ago
(1 row)

SELECT duration '-44 h';
    duration    
----------------
 @ 44 hours ago
(1 row)

SELECT duration '-45 minute';
   duration    
---------------
 @ 45 mins ago
(1 row)

SELECT duration '-46 minutes';
   duration    
---------------
 @ 46 mins ago
(1 row)

SELECT duration '-47 m';
   duration    
---------------
 @ 47 mins ago
(1 row)

SELECT duration '-48 second';
   duration    
---------------
 @ 48 secs ago
(1 row)

SELECT duration '-49 seconds';
   duration    
---------------
 @ 49 secs ago
(1 row)

SELECT duration '-50 s';
   duration    
---------------
 @ 50 secs ago
(1 row)

SELECT duration '-51 millisecond';
     duration     
------------------
 @ 0.051 secs ago
(1 row)

SELECT duration '-52 milliseconds';
     duration     
------------------
 @ 0.052 secs ago
(1 row)

SELECT duration '-53 ms';
     duration     
------------------
 @ 0.053 secs ago
(1 row)

SELECT duration '-54 microsecond';
      duration       
---------------------
 @ 0.000054 secs ago
(1 row)

SELECT duration '-55 microseconds';
      duration       
---------------------
 @ 0.000055 secs ago
(1 row)

SELECT duration '-56 us';
      duration       
---------------------
 @ 0.000056 secs ago
(1 row)

SELECT duration '1 minute 2 h 3 microseconds 4 second 5 ms';
           duration            
-------------------------------
 @ 2 hours 1 min 4.005003 secs
(1 row)

SELECT duration '36 minutes ago';
   duration    
---------------
 @ 36 mins ago
(1 row)

SELECT duration '20:13:41';
          duration          
----------------------------
 @ 20 hours 13 mins 41 secs
(1 row)

SELECT duration 'PT20:13:41';
          duration          
----------------------------
 @ 20 hours 13 mins 41 secs
(1 row)

-- Invalid duration input
SELECT duration '100 millennium';
ERROR:  invalid units for duration
LINE 1: SELECT duration '100 millennium';
                        ^
SELECT duration '101 millenniums';
ERROR:  invalid units for duration
LINE 1: SELECT duration '101 millenniums';
                        ^
SELECT duration '102 century';
ERROR:  invalid units for duration
LINE 1: SELECT duration '102 century';
                        ^
SELECT duration '103 centuries';
ERROR:  invalid units for duration
LINE 1: SELECT duration '103 centuries';
                        ^
SELECT duration '104 decade';
ERROR:  invalid units for duration
LINE 1: SELECT duration '104 decade';
                        ^
SELECT duration '105 decades';
ERROR:  invalid units for duration
LINE 1: SELECT duration '105 decades';
                        ^
SELECT duration '106 year';
ERROR:  invalid units for duration
LINE 1: SELECT duration '106 year';
                        ^
SELECT duration '107 years';
ERROR:  invalid units for duration
LINE 1: SELECT duration '107 years';
                        ^
SELECT duration '108 y';
ERROR:  invalid units for duration
LINE 1: SELECT duration '108 y';
                        ^
SELECT duration '109 month';
ERROR:  invalid units for duration
LINE 1: SELECT duration '109 month';
                        ^
SELECT duration '110 months';
ERROR:  invalid units for duration
LINE 1: SELECT duration '110 months';
                        ^
SELECT duration '111 week';
ERROR:  invalid units for duration
LINE 1: SELECT duration '111 week';
                        ^
SELECT duration '112 weeks';
ERROR:  invalid units for duration
LINE 1: SELECT duration '112 weeks';
                        ^
SELECT duration '113 w';
ERROR:  invalid units for duration
LINE 1: SELECT duration '113 w';
                        ^
SELECT duration '114 day';
ERROR:  invalid units for duration
LINE 1: SELECT duration '114 day';
                        ^
SELECT duration '115 days';
ERROR:  invalid units for duration
LINE 1: SELECT duration '115 days';
                        ^
SELECT duration '116 d';
ERROR:  invalid units for duration
LINE 1: SELECT duration '116 d';
                        ^
SELECT duration '5 seconds 2 days';
ERROR:  invalid units for duration
LINE 1: SELECT duration '5 seconds 2 days';
                        ^
SELECT duration 'P1995-08-06T20:13:41';
ERROR:  invalid units for duration
LINE 1: SELECT duration 'P1995-08-06T20:13:41';
                        ^
-- Comparison
SELECT duration '1 sec' < duration '1 hour';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 millisecond' < duration '1 ms';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 minute' < duration '1 us';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 sec' <= duration '1 hour';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 millisecond' <= duration '1 ms';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 minute' <= duration '1 us';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 sec' > duration '1 hour';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 millisecond' > duration '1 ms';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 minute' > duration '1 us';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 sec' >= duration '1 hour';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 millisecond' >= duration '1 ms';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 minute' >= duration '1 us';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 sec' = duration '1 hour';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 millisecond' = duration '1 ms';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 minute' = duration '1 us';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 sec' <> duration '1 hour';
 ?column? 
----------
 t
(1 row)

SELECT duration '1 millisecond' <> duration '1 ms';
 ?column? 
----------
 f
(1 row)

SELECT duration '1 minute' <> duration '1 us';
 ?column? 
----------
 t
(1 row)

-- Arithmetic
SELECT - duration '10 minutes';
   ?column?    
---------------
 @ 10 mins ago
(1 row)

SELECT duration '55 seconds' + duration '12 hours';
      ?column?      
--------------------
 @ 12 hours 55 secs
(1 row)

SELECT duration '2 hours' - duration '30 minutes';
     ?column?     
------------------
 @ 1 hour 30 mins
(1 row)

SELECT duration '42 minutes' * 10.5;
     ?column?      
-------------------
 @ 7 hours 21 mins
(1 row)

SELECT duration '42 minutes' * 0.0;
 ?column? 
----------
 @ 0
(1 row)

SELECT duration '5 hours 40 minutes 30 s' / 3.7;
            ?column?            
--------------------------------
 @ 1 hour 32 mins 1.621622 secs
(1 row)

SELECT - duration '-9223372036854775807 us';
ERROR:  duration out of range
SELECT duration '9223372036854775806 us' + duration '1 us';
ERROR:  duration out of range
SELECT duration '9223372036854775806 us' + duration '2 us';
ERROR:  duration out of range
SELECT duration '-9223372036854775807 us' - duration '1 us';
ERROR:  duration out of range
SELECT duration '-9223372036854775807 us' - duration '2 us';
ERROR:  duration out of range
SELECT duration '4611686018427387903 us' * 2.5;
ERROR:  duration out of range
SELECT duration '4611686018427387903 us' * 'nan'::float8;
ERROR:  duration out of range
SELECT duration '4611686018427387903 us' * 'infinity'::float8;
 ?column? 
----------
 infinity
(1 row)

SELECT duration '4611686018427387903 us' * '-infinity'::float8;
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration '0 us' * 'infinity'::float8;
ERROR:  duration out of range
SELECT duration '0 us' * '-infinity'::float8;
ERROR:  duration out of range
SELECT duration '-4611686018427387904 us' / 0.5;
ERROR:  duration out of range
SELECT duration '4611686018427387904 us' / 0.0;
ERROR:  division by zero
SELECT duration '4611686018427387904 us' / 'nan'::float8;
ERROR:  duration out of range
SELECT duration '4611686018427387903 us' / 'infinity'::float8;
 ?column? 
----------
 @ 0
(1 row)

SELECT duration '4611686018427387903 us' / '-infinity'::float8;
 ?column? 
----------
 @ 0
(1 row)

-- Infinity
SELECT duration 'infinity';
 duration 
----------
 infinity
(1 row)

SELECT duration '-infinity';
 duration  
-----------
 -infinity
(1 row)

SELECT duration 'infinity' > duration '999 hours';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' >= duration '999 hours';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' < duration '999 hours';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' <= duration '999 hours';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' = duration '999 hours';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' <> duration '999 hours';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' > duration '999 hours';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' >= duration '999 hours';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' < duration '999 hours';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' <= duration '999 hours';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' = duration '999 hours';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' <> duration '999 hours';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' > duration 'infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' >= duration 'infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' < duration 'infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' <= duration 'infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' = duration 'infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' <> duration 'infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' > duration '-infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' >= duration '-infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration 'infinity' < duration '-infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' <= duration '-infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' = duration '-infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration 'infinity' <> duration '-infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' > duration 'infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' >= duration 'infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' < duration 'infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' <= duration 'infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' = duration 'infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' <> duration 'infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' > duration '-infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' >= duration '-infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' < duration '-infinity';
 ?column? 
----------
 f
(1 row)

SELECT duration '-infinity' <= duration '-infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' = duration '-infinity';
 ?column? 
----------
 t
(1 row)

SELECT duration '-infinity' <> duration '-infinity';
 ?column? 
----------
 f
(1 row)

SELECT - duration 'infinity';
 ?column?  
-----------
 -infinity
(1 row)

SELECT - duration '-infinity';
 ?column? 
----------
 infinity
(1 row)

SELECT duration 'infinity' + duration '42 ms';
 ?column? 
----------
 infinity
(1 row)

SELECT duration '-infinity' + duration '42 ms';
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration 'infinity' + duration 'infinity';
 ?column? 
----------
 infinity
(1 row)

SELECT duration 'infinity' + duration '-infinity';
ERROR:  duration out of range
SELECT duration '-infinity' + duration 'infinity';
ERROR:  duration out of range
SELECT duration '-infinity' + duration '-infinity';
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration 'infinity' - duration '42 ms';
 ?column? 
----------
 infinity
(1 row)

SELECT duration '-infinity' - duration '42 ms';
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration 'infinity' - duration 'infinity';
ERROR:  duration out of range
SELECT duration 'infinity' - duration '-infinity';
 ?column? 
----------
 infinity
(1 row)

SELECT duration '-infinity' - duration 'infinity';
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration '-infinity' - duration '-infinity';
ERROR:  duration out of range
SELECT duration 'infinity' * 15.6;
 ?column? 
----------
 infinity
(1 row)

SELECT duration 'infinity' * -15.6;
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration 'infinity' * 'infinity'::float8;
 ?column? 
----------
 infinity
(1 row)

SELECT duration 'infinity' * '-infinity'::float8;
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration 'infinity' * 'nan'::float8;
ERROR:  duration out of range
SELECT duration 'infinity' * 0.0;
ERROR:  duration out of range
SELECT duration '-infinity' * 15.6;
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration '-infinity' * -15.6;
 ?column? 
----------
 infinity
(1 row)

SELECT duration '-infinity' * 'infinity'::float8;
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration '-infinity' * '-infinity'::float8;
 ?column? 
----------
 infinity
(1 row)

SELECT duration '-infinity' * 'nan'::float8;
ERROR:  duration out of range
SELECT duration '-infinity' * 0.0;
ERROR:  duration out of range
SELECT duration 'infinity' / 32.1;
 ?column? 
----------
 infinity
(1 row)

SELECT duration 'infinity' / -32.1;
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration 'infinity' / 'infinity'::float8;
ERROR:  duration out of range
SELECT duration 'infinity' / '-infinity'::float8;
ERROR:  duration out of range
SELECT duration 'infinity' / 'nan'::float8;
ERROR:  duration out of range
SELECT duration 'infinity' / 0.0;
ERROR:  division by zero
SELECT duration '-infinity' / 32.1;
 ?column?  
-----------
 -infinity
(1 row)

SELECT duration '-infinity' / -32.1;
 ?column? 
----------
 infinity
(1 row)

SELECT duration '-infinity' / 'infinity'::float8;
ERROR:  duration out of range
SELECT duration '-infinity' / '-infinity'::float8;
ERROR:  duration out of range
SELECT duration '-infinity' / 'nan'::float8;
ERROR:  duration out of range
SELECT duration '-infinity' / 0.0;
ERROR:  division by zero
-- This matches PostgreSQL semantics, but is probably incorrect.
SELECT duration '9223372036854775807 us';
 duration 
----------
 infinity
(1 row)

SELECT duration '-9223372036854775808 us';
 duration  
-----------
 -infinity
(1 row)

-- Inserts and indexes
DROP SCHEMA IF EXISTS regress CASCADE;
NOTICE:  schema "regress" does not exist, skipping
CREATE SCHEMA regress;
CREATE TABLE regress.t (d1 duration, d2 duration);
CREATE INDEX idx1 ON regress.t USING BTREE (d1);
CREATE INDEX idx2 ON regress.t USING HASH (d2);
INSERT INTO regress.t VALUES ('1 s 6 m', '5 us'), ('500ms 4 h', '42 seconds 3 us'), ('666 hours', '999 min');
SELECT * FROM regress.t;
         d1         |         d2         
--------------------+--------------------
 @ 6 mins 1 sec     | @ 0.000005 secs
 @ 4 hours 0.5 secs | @ 42.000003 secs
 @ 666 hours        | @ 16 hours 39 mins
(3 rows)

SELECT d1 FROM regress.t WHERE d1 > '1 hour';
         d1         
--------------------
 @ 4 hours 0.5 secs
 @ 666 hours
(2 rows)

SELECT d2 FROM regress.t WHERE d2 = '42 seconds 3 microseconds';
        d2        
------------------
 @ 42.000003 secs
(1 row)

DROP SCHEMA regress CASCADE;
NOTICE:  drop cascades to table regress.t
